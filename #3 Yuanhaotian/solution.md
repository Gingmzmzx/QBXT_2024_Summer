### A

首先不难发现问题可以转化为图上两个点的可达性, 直接建图复杂度为平方。

考虑优化建图，对于每个 $[0,3^{12})$ 的数值建一个新点, 然后集合里的元素可以指向某一位比自己小的新点，在新点中间只能走比自己大的边。

这样整个建图复杂度就是 $O(3^{12}\times 12)$ 的了， BFS 判断连通性即可。

### B

#### Sol 1

观察到在排序过较小的两个木棒一定是相邻的， 那么我们可以枚举这两个木棒，然后面积平方关于第三个木棒的长度是一个四次函数，可以二分/三分求的最优点。

#### Sol 2

其实三个木棒的长度都一定是相邻的！ 直接 $O(n)$ 枚举即可。

### C

通过翻转和将所有元素取反 ( $a \rightarrow n+1-a$ )，排列可以等价为两种情况：$ (1,3,2) $, $ (1,2,3) $

#### 暴力

枚举！时间复杂度 $O(n^3)$ 或者 $O(n^2)$。

#### 正解

先考虑 $ (1,3,2) $ 的情况，我们枚举中间的点 $v$ 的位置，然后用 $\binom{siz_v-1}{2}$ 减去在同一个子树内的答案即可，我们需要支持快速查询一个子树内小于某个值的点个数，这个可以归约到二维数点，使用任意数据结构可以做到 $O(n\log n)$，`std` 使用的是主席树。

然后是 $ (1,2,3) $ 的情况，我们还是先预处理出每个子树小于/大于 $v$ 的点有多少个，然后统计一下贡献就行了。

时间复杂度 $O(n\log n)$ 空间复杂度 $O(n)$ 或者 $O(n\log n)$。

### D

考虑分治，假设当前求的区间是 $[L, R]$，中点 $M = \left\lfloor \frac{L+R}{2} \right\rfloor$，首先递归的解决 $[L, M - 2]$ 和 $[M + 2, R]$ 的贡献。

对于 $s = M, M + 1$ 和 $t = M - 1, M$ 的贡献，我们可以直接暴力的求解 $dag$ 上的最短路，这部分是 $O(R - L)$ 的。

对于 $s \leq M - 1, t \geq M + 1$ 的部分，距离是

$$d(s, M - 1) + d(M - 1, t), d(s, M) + d(M, t), d(s, M + 1) + d(M + 1, t)$$

三者中的最小值，我们考虑每个部分什么时候会产生贡献，分别计算贡献。

以 $d(s, M - 1)$ 为例，当

$$d(s, M - 1) + d(M - 1, t) \leq d(s, M) + d(M, t), d(s, M - 1) + d(M - 1, t) \leq d(s, M + 1) + d(M + 1, t)$$

时产生贡献。

整理得：

$$d(s, M - 1) - d(s, M) \leq d(M - 1, t) - d(M, t), d(s, M - 1) - d(s, M) \leq d(M - 1, t) - d(M + 1, t)$$

我们对一个 $s$ 将两个不等式左边的值看成两维坐标，类似的对一个 $t$，将不等式右边的值看成两维坐标，那么这个问题就变成二维数点问题了，可以在 $O((R - L) \log (R - L))$ 的复杂度内解决。

其他的部分也可以类似解决。

最终复杂度 $T(n) = 2T(n/2) + O(n \log n) = O(n \log^2 n)$
